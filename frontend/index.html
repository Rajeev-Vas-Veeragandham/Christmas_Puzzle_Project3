<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ Christmas Puzzle - Graduate Edition</title>
    <link rel='stylesheet' href='css/style.css'>
    <link rel="stylesheet" href="css/graduate.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --christmas-red: #d42426;
            --christmas-green: #165b33;
            --christmas-gold: #ffd700;
            --christmas-blue: #0ea5e9;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(rgba(0, 20, 40, 0.9), rgba(0, 10, 30, 0.9));
            background-size: cover;
            background-attachment: fixed;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Snow Animation */
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        
        /* Christmas Lights Border */
        .lights {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, 
                #ff0000, #ff9900, #ffff00, #00ff00,
                #00ffff, #0000ff, #9900ff, #ff00ff);
            background-size: 800% 800%;
            animation: lights 3s infinite linear;
            z-index: 1000;
        }
        
        @keyframes lights {
            0% { background-position: 0% 0%; }
            100% { background-position: 800% 0%; }
        }
        
        .lights-bottom {
            top: auto;
            bottom: 0;
        }
        
        .lights-left {
            width: 5px;
            height: 100%;
            background: linear-gradient(180deg, 
                #ff0000, #ff9900, #ffff00, #00ff00,
                #00ffff, #0000ff, #9900ff, #ff00ff);
            background-size: 800% 800%;
            animation: lights-vertical 3s infinite linear;
        }
        
        .lights-right {
            left: auto;
            right: 0;
        }
        
        @keyframes lights-vertical {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 800%; }
        }
        
        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            padding-top: 80px;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 1s ease;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .title {
            font-size: 4rem;
            background: linear-gradient(45deg, var(--christmas-gold), #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            font-family: 'Mountains of Christmas', cursive;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 20px;
        }
        
        .graduate-badge {
            display: inline-block;
            background: linear-gradient(45deg, var(--christmas-blue), #8b5cf6);
            color: white;
            padding: 10px 25px;
            border-radius: 30px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
            animation: pulse 2s infinite;
            margin-bottom: 30px;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Auth Section */
        .auth-section {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .auth-btn {
            background: linear-gradient(45deg, var(--christmas-red), #a00);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(212, 36, 38, 0.3);
        }
        
        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(212, 36, 38, 0.5);
        }
        
        /* Versions Grid */
        .versions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }
        
        .version-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid transparent;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .version-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--christmas-gold);
            transform: scaleX(0);
            transition: transform 0.4s;
        }
        
        .version-card:hover {
            transform: translateY(-10px);
            border-color: var(--christmas-gold);
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.2);
        }
        
        .version-card:hover::before {
            transform: scaleX(1);
        }
        
        .version-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: inline-block;
            padding: 20px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .santa-icon { color: var(--christmas-red); }
        .reindeer-icon { color: var(--christmas-green); }
        .elf-icon { color: var(--christmas-blue); }
        
        .version-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: white;
        }
        
        .version-desc {
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .features {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .feature-tag {
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .play-btn {
            background: linear-gradient(45deg, var(--christmas-gold), #ffaa00);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .play-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.4);
        }
        
        /* Configuration */
        .config-section {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin: 50px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .config-title {
            color: var(--christmas-gold);
            font-size: 1.5rem;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .config-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
            position: relative;
        }
        
        .config-label {
            color: var(--christmas-gold);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-select {
            padding: 12px 20px;
            padding-right: 40px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            width: 100%;
            background-image: linear-gradient(45deg, transparent 50%, var(--christmas-gold) 50%),
                              linear-gradient(135deg, var(--christmas-gold) 50%, transparent 50%);
            background-position: calc(100% - 20px) calc(1em + 2px),
                                 calc(100% - 15px) calc(1em + 2px);
            background-size: 5px 5px,
                             5px 5px;
            background-repeat: no-repeat;
        }
        
        .config-select:hover {
            border-color: var(--christmas-gold);
            background-color: rgba(0, 0, 0, 0.9);
        }
        
        .config-select:focus {
            outline: none;
            border-color: var(--christmas-gold);
            box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
            background-color: rgba(0, 0, 0, 1);
        }
        
        /* Dropdown options styling */
        .config-select option {
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px;
            font-size: 0.95rem;
        }
        
        .config-select option:checked {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            color: var(--christmas-gold);
            font-weight: bold;
        }
        
        .config-select option:hover {
            background: linear-gradient(45deg, rgba(255, 215, 0, 0.3), rgba(255, 215, 0, 0.2));
            color: white;
        }
        
        /* For Firefox */
        @-moz-document url-prefix() {
            .config-select {
                padding-right: 30px;
                background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="%23ffd700"><path d="M7 10l5 5 5-5z"/></svg>');
                background-repeat: no-repeat;
                background-position: right 10px center;
                background-size: 12px;
            }
        }
        
        .config-select::-ms-expand {
            display: none;
        }
        
        /* Graduate Dashboard */
        .dashboard {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            margin: 50px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .dashboard-title {
            color: var(--christmas-gold);
            font-size: 1.5rem;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            border-left: 4px solid var(--christmas-gold);
        }
        
        .card-title {
            color: white;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 18px 35px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            min-width: 200px;
            justify-content: center;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--christmas-red), #a00);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, var(--christmas-blue), #0369a1);
            color: white;
        }
        
        .btn-tertiary {
            background: linear-gradient(45deg, var(--christmas-green), #047857);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .footer-link {
            color: var(--christmas-gold);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }
        
        .footer-link:hover {
            color: white;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: linear-gradient(45deg, #1e293b, #0f172a);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid var(--christmas-gold);
            position: relative;
            animation: modalSlideIn 0.5s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--christmas-gold);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: rgba(255, 215, 0, 0.1);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .versions-grid {
                grid-template-columns: 1fr;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .auth-section {
                position: static;
                text-align: center;
                margin-bottom: 20px;
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--christmas-gold);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Christmas Lights Border -->
    <div class="lights"></div>
    <div class="lights lights-bottom"></div>
    <div class="lights lights-left"></div>
    <div class="lights lights-right"></div>
    
    <!-- Snow Animation -->
    <div class="snow-container" id="snowContainer"></div>
    
    <!-- Background Music -->
    <audio id="bgMusic" loop>
        <source src="assets/music/christmas_soft.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <!-- Sound Effects (hidden) -->
    <audio id="clickSound" preload="auto">
        <source src="assets/sounds/click.mp3" type="audio/mpeg">
    </audio>
    <audio id="shuffleSound" preload="auto">
        <source src="assets/sounds/shuffle.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound" preload="auto">
        <source src="assets/sounds/win.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Auth Section -->
    <div class="auth-section" id="authSection">
        <button class="auth-btn" onclick="showAuthModal()">
            <i class="fas fa-user"></i> Login / Register
        </button>
    </div>
    
    <!-- Main Content -->
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <h1 class="title">üéÑ Christmas Puzzle</h1>
            <p class="subtitle">Graduate Edition - Advanced AI, Analytics & Interactive Story</p>
        </div>
        
        <!-- Three Versions -->
        <div class="versions-grid">
            <!-- Santa's Workshop -->
            <div class="version-card" onclick="selectVersion('santa')">
                <div class="version-icon santa-icon">
                    <i class="fas fa-sleigh"></i>
                </div>
                <h3 class="version-title">Santa's Workshop</h3>
                <p class="version-desc">
                    <strong>Adaptive AI</strong> that learns from your moves. 
                    Difficulty adjusts in real-time based on your performance.
                    Features predictive analytics and behavior analysis.
                </p>
                <div class="features">
                    <span class="feature-tag">Adaptive Difficulty</span>
                    <span class="feature-tag">Predictive AI</span>
                    <span class="feature-tag">Behavior Analysis</span>
                </div>
                <button class="play-btn" onclick="startGame('santa')">
                    <i class="fas fa-play"></i> Play Santa's Workshop
                </button>
            </div>
            
            <!-- Reindeer Games -->
            <div class="version-card" onclick="selectVersion('reindeer')">
                <div class="version-icon reindeer-icon">
                    <i class="fas fa-horse-head"></i>
                </div>
                <h3 class="version-title">Reindeer Games</h3>
                <p class="version-desc">
                    <strong>Social & Multiplayer</strong> features with leaderboards.
                    Challenge friends, track progress, and compete globally.
                    Includes magic power-ups and special abilities.
                </p>
                <div class="features">
                    <span class="feature-tag">Multiplayer</span>
                    <span class="feature-tag">Magic Powers</span>
                    <span class="feature-tag">Leaderboards</span>
                </div>
                <button class="play-btn" onclick="startGame('reindeer')">
                    <i class="fas fa-play"></i> Play Reindeer Games
                </button>
            </div>
            
            <!-- Elf AI Workshop -->
            <div class="version-card" onclick="selectVersion('elf')">
                <div class="version-icon elf-icon">
                    <i class="fas fa-hat-wizard"></i>
                </div>
                <h3 class="version-title">Elf AI Workshop</h3>
                <p class="version-desc">
                    <strong>Advanced AI</strong> with neural network predictions.
                    Interactive Christmas story with branching narratives.
                    Complete photo tiles and immersive experience.
                </p>
                <div class="features">
                    <span class="feature-tag">AI Neural Network</span>
                    <span class="feature-tag">Interactive Story</span>
                    <span class="feature-tag">Photo Tiles</span>
                </div>
                <button class="play-btn" onclick="startGame('elf')">
                    <i class="fas fa-play"></i> Play Elf AI Workshop
                </button>
            </div>
        </div>
        
        <!-- Configuration -->
        <div class="config-section">
            <h3 class="config-title">
                <i class="fas fa-cog"></i> Game Configuration
            </h3>
            
            <div class="config-grid">
                <div class="config-item">
                    <label class="config-label" for="boardSize">
                        <i class="fas fa-th-large"></i> Board Size
                    </label>
                    <select id="boardSize" class="config-select">
                        <option value="3">3√ó3 (Easy)</option>
                        <option value="4" selected>4√ó4 (Classic)</option>
                        <option value="5">5√ó5 (Hard)</option>
                        <option value="6">6√ó6 (Expert)</option>
                        <option value="8">8√ó8 (Master)</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label class="config-label" for="themeSelect">
                        <i class="fas fa-palette"></i> Theme
                    </label>
                    <select id="themeSelect" class="config-select" onchange="applyTheme(this.value)">
                        <option value="santa">Santa's Workshop</option>
                        <option value="reindeer">Reindeer Forest</option>
                        <option value="candy">Candy Cane</option>
                        <option value="cozy">Cozy Fireplace</option>
                        <option value="northern">Northern Lights</option>
                        <option value="frost">Frost Palace</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label class="config-label" for="difficulty">
                        <i class="fas fa-sliders-h"></i> Difficulty Level
                    </label>
                    <input type="range" id="difficulty" class="config-select" 
                           min="1" max="5" value="3" step="0.5"
                           oninput="updateDifficulty(this.value)">
                    <div style="color: white; text-align: center; margin-top: 10px;">
                        Level: <span id="diffValue" style="color: var(--christmas-gold);">3.0</span>/5.0
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="action-btn btn-primary" onclick="startCustomGame()">
                    <i class="fas fa-rocket"></i> Start Custom Game
                </button>
            </div>
        </div>
        
        <!-- Graduate Dashboard -->
        <div class="dashboard">
            <h3 class="dashboard-title">
                <i class="fas fa-graduation-cap"></i> Graduate Features Dashboard
            </h3>
            
            <div class="dashboard-grid">
                <!-- AI Analytics -->
                <div class="dashboard-card">
                    <h4 class="card-title">
                        <i class="fas fa-brain"></i> Predictive Analytics
                    </h4>
                    <div id="analyticsContent">
                        <p>Loading player behavior analysis...</p>
                    </div>
                </div>
                
                <!-- Story Progress -->
                <div class="dashboard-card">
                    <h4 class="card-title">
                        <i class="fas fa-book"></i> Christmas Story
                    </h4>
                    <div id="storyProgress">
                        <p>Interactive story with branching narratives.</p>
                        <button class="play-btn" style="margin-top: 15px; padding: 10px 20px;" 
                                onclick="openStoryMode()">
                            <i class="fas fa-book-open"></i> Continue Story
                        </button>
                    </div>
                </div>
                
                <!-- Magic System -->
                <div class="dashboard-card">
                    <h4 class="card-title">
                        <i class="fas fa-magic"></i> Magic Powers
                    </h4>
                    <div id="magicSystem">
                        <p>Advanced power-up system with resource management:</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                            <div style="background: rgba(59,130,246,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #3b82f6; font-size: 0.9rem; font-weight: bold;">Elf's Wisdom</div>
                                <div style="color: white; font-size: 0.8rem;">25 mana</div>
                                <div style="color: #94a3b8; font-size: 0.7rem;">Optimal hint</div>
                            </div>
                            <div style="background: rgba(139,92,246,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #8b5cf6; font-size: 0.9rem; font-weight: bold;">Time Freeze</div>
                                <div style="color: white; font-size: 0.8rem;">40 mana</div>
                                <div style="color: #94a3b8; font-size: 0.7rem;">Stop timer</div>
                            </div>
                            <div style="background: rgba(16,185,129,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #10b981; font-size: 0.9rem; font-weight: bold;">Crystal Vision</div>
                                <div style="color: white; font-size: 0.8rem;">35 mana</div>
                                <div style="color: #94a3b8; font-size: 0.7rem;">See positions</div>
                            </div>
                            <div style="background: rgba(245,158,11,0.1); padding: 10px; border-radius: 8px; text-align: center;">
                                <div style="color: #f59e0b; font-size: 0.9rem; font-weight: bold;">Santa's Magic</div>
                                <div style="color: white; font-size: 0.8rem;">50 mana</div>
                                <div style="color: #94a3b8; font-size: 0.7rem;">Solve piece</div>
                            </div>
                        </div>
                        <button class="play-btn" style="margin-top: 15px; padding: 10px 20px;" 
                                onclick="showMagicSystemInfo()">
                            <i class="fas fa-hat-wizard"></i> View Magic System Details
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn btn-secondary" onclick="openLeaderboard()">
                <i class="fas fa-crown"></i> View Leaderboard
            </button>
            <button class="action-btn btn-tertiary" onclick="openAnalyticsDashboard()">
                <i class="fas fa-chart-line"></i> Analytics Dashboard
            </button>
            <button class="action-btn btn-primary" onclick="openDailyChallenge()">
                <i class="fas fa-calendar-star"></i> Daily Challenge
            </button>
        </div>
        
        <!-- Footer -->
        <div class="footer">
            <p>üéÑ Christmas PuzzleüéÑ</p>
            
            <div class="footer-links">
                <a href="#" class="footer-link" onclick="showDevJournal()">
                    <i class="fas fa-book"></i> Development Journal
                </a>
                <a href="#" class="footer-link" onclick="showFeatures()">
                    <i class="fas fa-list-check"></i> Features List
                </a>
                <a href="#" class="footer-link" onclick="toggleMusic()">
                    <i class="fas fa-music"></i> Toggle Music
                </a>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal-overlay" id="leaderboardModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeLeaderboard()">√ó</button>
            <h2 style="color: var(--christmas-gold); text-align: center; margin-bottom: 30px;">
                <i class="fas fa-crown"></i> Global Leaderboard
            </h2>
            <div id="leaderboardContent">
                <table style="width: 100%; border-collapse: collapse; color: white;">
                    <thead>
                        <tr style="background: rgba(255,215,0,0.2);">
                            <th style="padding: 15px; text-align: left;">Rank</th>
                            <th style="padding: 15px; text-align: left;">Player</th>
                            <th style="padding: 15px; text-align: left;">XP</th>
                            <th style="padding: 15px; text-align: left;">Best Time</th>
                            <th style="padding: 15px; text-align: left;">Wins</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                        <!-- Will be populated -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="analyticsModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAnalytics()">√ó</button>
            <h2 style="color: var(--christmas-gold); text-align: center; margin-bottom: 30px;">
                <i class="fas fa-chart-line"></i> Predictive Analytics Dashboard
            </h2>
            <div id="analyticsDashboard">
                <!-- Will be populated -->
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="js/main.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            createSnowflakes();
            initBackgroundMusic();
            loadAnalytics();
            loadUserData();
            
            // Apply saved theme
            const savedTheme = localStorage.getItem('theme') || 'santa';
            applyTheme(savedTheme);
            document.getElementById('themeSelect').value = savedTheme;
            
            // Apply saved difficulty
            const savedDiff = localStorage.getItem('difficulty') || 3;
            document.getElementById('difficulty').value = savedDiff;
            document.getElementById('diffValue').textContent = savedDiff;
        });
        
        function createSnowflakes() {
            const container = document.getElementById('snowContainer');
            container.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.style.width = Math.random() * 10 + 5 + 'px';
                flake.style.height = flake.style.width;
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = Math.random() * 10 + 5 + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                flake.style.opacity = Math.random() * 0.5 + 0.3;
                container.appendChild(flake);
            }
        }
        
        function initBackgroundMusic() {
            const music = document.getElementById('bgMusic');
            if (!music) return;
            
            music.volume = 0.3;
            music.loop = true;
            
            // Try to play with user interaction
            const playMusic = () => {
                music.play().catch(e => {
                    console.log('Autoplay prevented, will play after user interaction');
                });
            };
            
            // Try to play on page load
            setTimeout(playMusic, 1000);
            
            // Play on first user interaction
            document.addEventListener('click', function initMusic() {
                playMusic();
                document.removeEventListener('click', initMusic);
            }, { once: true });
        }
        
        function toggleMusic() {
            const music = document.getElementById('bgMusic');
            if (music.paused) {
                music.play();
                playSound('click');
                showNotification('Music turned ON', 'success');
            } else {
                music.pause();
                playSound('click');
                showNotification('Music turned OFF', 'info');
            }
        }
        
        function selectVersion(version) {
            document.querySelectorAll('.version-card').forEach(card => {
                card.style.borderColor = 'transparent';
            });
            event.currentTarget.style.borderColor = 'var(--christmas-gold)';
            localStorage.setItem('selectedVersion', version);
            playSound('click');
        }
        
        function applyTheme(theme) {
            localStorage.setItem('theme', theme);
            
            // Change background based on theme
            const themes = {
                'santa': 'linear-gradient(rgba(139, 0, 0, 0.8), rgba(0, 100, 0, 0.8))',
                'reindeer': 'linear-gradient(rgba(0, 50, 100, 0.8), rgba(0, 100, 50, 0.8))',
                'candy': 'linear-gradient(rgba(255, 105, 180, 0.8), rgba(255, 20, 147, 0.8))',
                'cozy': 'linear-gradient(rgba(139, 69, 19, 0.8), rgba(101, 67, 33, 0.8))',
                'northern': 'linear-gradient(rgba(0, 20, 40, 0.9), rgba(0, 10, 30, 0.9))',
                'frost': 'linear-gradient(rgba(135, 206, 235, 0.8), rgba(176, 224, 230, 0.8))'
            };
            
            document.body.style.background = themes[theme] || themes['northern'];
            playSound('click');
        }
        
        function updateDifficulty(value) {
            document.getElementById('diffValue').textContent = value;
            localStorage.setItem('difficulty', value);
            playSound('click');
        }
        
        function startGame(version) {
            const size = document.getElementById('boardSize').value;
            const theme = document.getElementById('themeSelect').value;
            const difficulty = document.getElementById('difficulty').value;
            
            localStorage.setItem('gameVersion', version);
            localStorage.setItem('gameSize', size);
            localStorage.setItem('gameTheme', theme);
            localStorage.setItem('gameDifficulty', difficulty);
            
            // Play sound
            playSound('click');
            
            window.location.href = `puzzle.html?version=${version}&size=${size}`;
        }
        
        function startCustomGame() {
            const version = localStorage.getItem('selectedVersion') || 'santa';
            startGame(version);
        }
        
        // Sound Functions
        function playSound(type) {
            try {
                let audio;
                switch(type) {
                    case 'click':
                        audio = document.getElementById('clickSound');
                        break;
                    case 'shuffle':
                        audio = document.getElementById('shuffleSound');
                        break;
                    case 'win':
                    case 'success':
                    case 'victory':
                        audio = document.getElementById('winSound');
                        break;
                    default:
                        audio = document.getElementById('clickSound');
                }
                
                if (audio) {
                    audio.currentTime = 0; // Reset to start
                    audio.volume = 0.7;
                    audio.play().catch(e => {
                        console.log('Sound play failed:', e);
                        // Fallback beep for important sounds
                        if (type === 'win' || type === 'victory' || type === 'success') {
                            console.log('\u0007'); // System beep
                        }
                    });
                }
            } catch (error) {
                console.log('Sound error:', error);
            }
        }
        
        // Updated functions for navigation
        function openStoryMode() {
            playSound('click');
            window.location.href = 'story.html';
        }
        
        function openDailyChallenge() {
            playSound('click');
            window.location.href = 'daily-challenge.html';
        }
        
        // Magic System Info Modal - FIXED VERSION
        function showMagicSystemInfo() {
            playSound('click');
            
            const modal = document.createElement('div');
            modal.className = 'magic-system-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                backdrop-filter: blur(5px);
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(45deg, #1e293b, #0f172a);
                           padding: 40px;
                           border-radius: 20px;
                           width: 90%;
                           max-width: 800px;
                           max-height: 80vh;
                           overflow-y: auto;
                           border: 3px solid var(--christmas-gold);
                           position: relative;">
                    <button class="magic-modal-close" 
                            style="position: absolute; top: 15px; right: 15px; 
                                   background: none; border: none; color: var(--christmas-gold); 
                                   font-size: 1.5rem; cursor: pointer; padding: 10px; 
                                   border-radius: 50%; transition: all 0.3s;"
                            onclick="closeMagicModal()">
                        √ó
                    </button>
                    
                    <h2 style="color: var(--christmas-gold); text-align: center; margin-bottom: 30px;">
                        <i class="fas fa-hat-wizard"></i> Magic Power-up System
                    </h2>
                    
                    <div style="color: white; margin-bottom: 30px;">
                        <p style="text-align: center; color: #94a3b8; font-size: 1.1rem; margin-bottom: 30px;">
                            Graduate Feature: Complete magic system with 5 unique power-ups, resource management, and visual effects
                        </p>
                        
                        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; margin-bottom: 30px;">
                            <!-- Elf's Wisdom -->
                            <div style="background: rgba(59,130,246,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div style="color: #3b82f6; font-weight: bold; font-size: 1.2rem;">Elf's Wisdom</div>
                                        <div style="color: #94a3b8; margin-top: 5px;">Reveals the optimal next move with visual highlighting</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #00b4d8; font-weight: bold;">25 mana</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Cooldown: 30s</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Time Freeze -->
                            <div style="background: rgba(139,92,246,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #8b5cf6;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div style="color: #8b5cf6; font-weight: bold; font-size: 1.2rem;">Frozen Moment</div>
                                        <div style="color: #94a3b8; margin-top: 5px;">Freezes the timer for 10 seconds with frost effects</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #00b4d8; font-weight: bold;">40 mana</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Cooldown: 60s</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Reindeer Shuffle -->
                            <div style="background: rgba(16,185,129,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #10b981;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div style="color: #10b981; font-weight: bold; font-size: 1.2rem;">Reindeer Shuffle</div>
                                        <div style="color: #94a3b8; margin-top: 5px;">Intelligently reshuffles the puzzle while keeping it solvable</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #00b4d8; font-weight: bold;">30 mana</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Cooldown: 45s</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Crystal Vision -->
                            <div style="background: rgba(245,158,11,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div style="color: #f59e0b; font-weight: bold; font-size: 1.2rem;">Crystal Vision</div>
                                        <div style="color: #94a3b8; margin-top: 5px;">Highlights correct and incorrect tile positions for 8 seconds</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #00b4d8; font-weight: bold;">35 mana</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Cooldown: 45s</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Santa's Magic -->
                            <div style="background: rgba(239,68,68,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #ef4444;">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <div style="color: #ef4444; font-weight: bold; font-size: 1.2rem;">Santa's Magic</div>
                                        <div style="color: #94a3b8; margin-top: 5px;">Instantly solves one misplaced tile (most advanced power-up)</div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="color: #00b4d8; font-weight: bold;">50 mana</div>
                                        <div style="color: #94a3b8; font-size: 0.9rem;">Cooldown: 90s</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 style="color: var(--christmas-gold); margin-bottom: 10px;">System Features:</h4>
                            <ul style="color: #cbd5e1; padding-left: 20px;">
                                <li>üß† <strong>Mana Management:</strong> Mana regenerates over time and with successful moves</li>
                                <li>‚è±Ô∏è <strong>Cooldown System:</strong> Each power-up has individual cooldown timers</li>
                                <li>‚ú® <strong>Visual Effects:</strong> Unique animations for each power-up activation</li>
                                <li>üéØ <strong>Strategic Depth:</strong> Choose power-ups based on puzzle situation</li>
                                <li>üìä <strong>Resource Balance:</strong> Higher effects require more mana and longer cooldowns</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="closeMagicModal()" 
                                style="background: var(--christmas-gold); color: black; padding: 12px 30px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 1rem;">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            // Close when clicking on background overlay
            modal.onclick = function(e) {
                if (e.target === modal) {
                    closeMagicModal();
                }
            };
            
            document.body.appendChild(modal);
            
            // Prevent clicks inside the modal from closing it
            const modalContent = modal.querySelector('div');
            modalContent.onclick = function(e) {
                e.stopPropagation();
            };
        }
        
        // Function to close magic modal
        function closeMagicModal() {
            playSound('click');
            const modal = document.querySelector('.magic-system-modal');
            if (modal) {
                modal.style.opacity = '0';
                modal.style.transform = 'scale(0.9)';
                modal.style.transition = 'all 0.3s';
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                }, 300);
            }
        }
        
        async function loadAnalytics() {
            try {
                const response = await fetch('http://localhost:3000/api/analytics/1');
                const data = await response.json();
                
                if (data.success) {
                    updateAnalyticsDisplay(data);
                }
            } catch (error) {
                // Fallback analytics
                const fallbackAnalytics = {
                    winRate: 65,
                    avgTime: 85,
                    avgMoves: 52,
                    bestTime: 42,
                    streak: 3,
                    prediction: "You're improving! Try 5√ó5 puzzles next."
                };
                updateAnalyticsDisplay({ statistics: fallbackAnalytics });
            }
        }
        
        function updateAnalyticsDisplay(data) {
            const stats = data.statistics;
            const html = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                    <div style="background: rgba(255,215,0,0.1); padding: 15px; border-radius: 10px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">Win Rate</div>
                        <div style="color: var(--christmas-gold); font-size: 1.5rem; font-weight: bold;">
                            ${stats.winRate || 65}%
                        </div>
                    </div>
                    <div style="background: rgba(59,130,246,0.1); padding: 15px; border-radius: 10px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">Avg Time</div>
                        <div style="color: #3b82f6; font-size: 1.5rem; font-weight: bold;">
                            ${stats.avgTime || 85}s
                        </div>
                    </div>
                    <div style="background: rgba(34,197,94,0.1); padding: 15px; border-radius: 10px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">Avg Moves</div>
                        <div style="color: #22c55e; font-size: 1.5rem; font-weight: bold;">
                            ${stats.avgMoves || 52}
                        </div>
                    </div>
                    <div style="background: rgba(139,92,246,0.1); padding: 15px; border-radius: 10px;">
                        <div style="color: #94a3b8; font-size: 0.9rem;">Best Time</div>
                        <div style="color: #8b5cf6; font-size: 1.5rem; font-weight: bold;">
                            ${stats.bestTime || 42}s
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(56,189,248,0.1); border-radius: 10px; border-left: 4px solid #38bdf8;">
                    <div style="color: #94a3b8; font-size: 0.9rem;">AI Prediction</div>
                    <div style="color: white; margin-top: 5px;">${data.recommendation?.tip || "Try planning 3 moves ahead for better efficiency"}</div>
                </div>
            `;
            
            document.getElementById('analyticsContent').innerHTML = html;
        }
        
        function openLeaderboard() {
            playSound('click');
            document.getElementById('leaderboardModal').style.display = 'flex';
            loadLeaderboardData();
        }
        
        function closeLeaderboard() {
            playSound('click');
            document.getElementById('leaderboardModal').style.display = 'none';
        }
        
        async function loadLeaderboardData() {
            try {
                const response = await fetch('http://localhost:3000/api/leaderboard');
                const data = await response.json();
                
                const tbody = document.getElementById('leaderboardBody');
                if (data.success && data.leaderboard) {
                    tbody.innerHTML = '';
                    data.leaderboard.forEach((player, index) => {
                        const medals = ['ü•á', 'ü•à', 'ü•â'];
                        const row = document.createElement('tr');
                        row.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                        row.innerHTML = `
                            <td style="padding: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-weight: bold; color: ${index < 3 ? 'var(--christmas-gold)' : 'white'}">
                                        ${index + 1}
                                    </span>
                                    ${index < 3 ? medals[index] : ''}
                                </div>
                            </td>
                            <td style="padding: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 35px; height: 35px; border-radius: 50%; 
                                                background: linear-gradient(45deg, var(--christmas-gold), var(--christmas-red)); 
                                                display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                        ${player.username.charAt(0)}
                                    </div>
                                    ${player.username}
                                </div>
                            </td>
                            <td style="padding: 15px; font-weight: bold; color: var(--christmas-gold);">
                                ${player.xp_points}
                            </td>
                            <td style="padding: 15px;">
                                ${player.best_time || '--'}s
                            </td>
                            <td style="padding: 15px;">
                                ${player.wins || 0}
                            </td>
                        `;
                        tbody.appendChild(row);
                    });
                }
            } catch (error) {
                // Fallback data
                const fallbackData = [
                    { username: 'Santa_Claus', xp_points: 5000, best_time: 42, wins: 25 },
                    { username: 'Elf_Master', xp_points: 4500, best_time: 45, wins: 22 },
                    { username: 'Rudolph', xp_points: 3200, best_time: 48, wins: 18 },
                    { username: 'Snow_Queen', xp_points: 2800, best_time: 52, wins: 15 },
                    { username: 'Frosty', xp_points: 1900, best_time: 55, wins: 12 }
                ];
                
                const tbody = document.getElementById('leaderboardBody');
                tbody.innerHTML = '';
                fallbackData.forEach((player, index) => {
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const row = document.createElement('tr');
                    row.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                    row.innerHTML = `
                        <td style="padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-weight: bold; color: ${index < 3 ? 'var(--christmas-gold)' : 'white'}">
                                    ${index + 1}
                                </span>
                                ${index < 3 ? medals[index] : ''}
                            </div>
                        </td>
                        <td style="padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 35px; height: 35px; border-radius: 50%; 
                                            background: linear-gradient(45deg, var(--christmas-gold), var(--christmas-red)); 
                                            display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${player.username.charAt(0)}
                                </div>
                                ${player.username}
                            </div>
                        </td>
                        <td style="padding: 15px; font-weight: bold; color: var(--christmas-gold);">
                            ${player.xp_points}
                        </td>
                        <td style="padding: 15px;">
                            ${player.best_time}s
                        </td>
                        <td style="padding: 15px;">
                            ${player.wins}
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }
        
        function openAnalyticsDashboard() {
            playSound('click');
            document.getElementById('analyticsModal').style.display = 'flex';
            loadDetailedAnalytics();
        }
        
        function closeAnalytics() {
            playSound('click');
            document.getElementById('analyticsModal').style.display = 'none';
        }
        
        function loadDetailedAnalytics() {
            const html = `
                <div style="color: white;">
                    <h3 style="color: var(--christmas-gold); margin-bottom: 20px;">
                        <i class="fas fa-brain"></i> Player Behavior Analysis
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px;">
                            <h4 style="color: #94a3b8; margin-bottom: 10px;">Pattern Recognition</h4>
                            <ul style="padding-left: 20px;">
                                <li>Prefers solving corners first</li>
                                <li>Average move planning: 2.3 steps</li>
                                <li>Common hesitation point: Mid-game transitions</li>
                                <li>Optimal path deviation: 18%</li>
                            </ul>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px;">
                            <h4 style="color: #94a3b8; margin-bottom: 10px;">Performance Metrics</h4>
                            <ul style="padding-left: 20px;">
                                <li>Learning rate: 0.42 (Fast learner)</li>
                                <li>Consistency score: 78/100</li>
                                <li>Adaptability: 65/100</li>
                                <li>Efficiency trend: ‚Üó Improving</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--christmas-gold); margin-bottom: 20px;">
                        <i class="fas fa-chart-line"></i> Predictive Difficulty Adjustment
                    </h3>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p>Based on your performance, the AI recommends:</p>
                        <div style="display: flex; align-items: center; gap: 15px; margin-top: 15px;">
                            <div style="background: var(--christmas-green); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold;">
                                Next Difficulty: 3.8/5.0
                            </div>
                            <div style="color: #94a3b8;">
                                (AI predicts 72% success rate)
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="color: var(--christmas-gold); margin-bottom: 20px;">
                        <i class="fas fa-robot"></i> AI Recommendations
                    </h3>
                    
                    <div style="background: rgba(56,189,248,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #38bdf8;">
                        <p><strong>Focus Areas:</strong></p>
                        <ol style="padding-left: 20px; margin-top: 10px;">
                            <li>Practice edge pieces movement patterns</li>
                            <li>Try the "Look-ahead 3" strategy</li>
                            <li>Use Manhattan distance heuristic more effectively</li>
                            <li>Challenge yourself with time-limited puzzles</li>
                        </ol>
                    </div>
                </div>
            `;
            
            document.getElementById('analyticsDashboard').innerHTML = html;
        }
        
        function showAuthModal() {
            playSound('click');
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            
            modal.innerHTML = `
                <div style="background: linear-gradient(45deg, #1e293b, #0f172a);
                           padding: 40px;
                           border-radius: 20px;
                           width: 90%;
                           max-width: 400px;
                           border: 3px solid var(--christmas-gold);">
                    <h2 style="color: var(--christmas-gold); text-align: center; margin-bottom: 30px;">
                        <i class="fas fa-user"></i> Authentication
                    </h2>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <input type="text" id="authUsername" placeholder="Username" 
                               style="padding: 15px; background: rgba(255,255,255,0.05); 
                                      border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;">
                        <input type="password" id="authPassword" placeholder="Password" 
                               style="padding: 15px; background: rgba(255,255,255,0.05); 
                                      border: 2px solid rgba(255,255,255,0.2); border-radius: 10px; color: white;">
                        <button onclick="handleLogin()" 
                                style="background: linear-gradient(45deg, var(--christmas-gold), #ffaa00); 
                                       color: black; padding: 15px; border-radius: 10px; font-weight: bold; 
                                       border: none; cursor: pointer;">
                            Sign In
                        </button>
                        <div style="text-align: center; color: #94a3b8; font-size: 0.9rem;">
                            For demo: Any credentials will work
                        </div>
                    </div>
                </div>
            `;
            
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
            
            document.body.appendChild(modal);
            
            // Focus username
            setTimeout(() => {
                const input = document.getElementById('authUsername');
                if (input) input.focus();
            }, 100);
        }
        
        function handleLogin() {
            const username = document.getElementById('authUsername').value || 'Player';
            localStorage.setItem('username', username);
            
            // Update UI
            document.getElementById('authSection').innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px; padding: 10px; 
                           background: rgba(255,215,0,0.1); border-radius: 20px; border: 2px solid var(--christmas-gold);">
                    <div style="width: 40px; height: 40px; border-radius: 50%; 
                               background: linear-gradient(45deg, var(--christmas-gold), var(--christmas-red)); 
                               display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        ${username.charAt(0)}
                    </div>
                    <div>
                        <div style="font-weight: bold; color: white;">${username}</div>
                        <div style="color: var(--christmas-gold); font-size: 0.8rem;">Player</div>
                    </div>
                </div>
            `;
            
            // Close modal
            const modal = document.querySelector('div[style*="position: fixed; top: 0"]');
            if (modal) {
                document.body.removeChild(modal);
            }
            
            playSound('success');
        }
        
        function loadUserData() {
            const username = localStorage.getItem('username');
            if (username) {
                document.getElementById('authSection').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; 
                               background: rgba(255,215,0,0.1); border-radius: 20px; border: 2px solid var(--christmas-gold);">
                        <div style="width: 40px; height: 40px; border-radius: 50%; 
                                   background: linear-gradient(45deg, var(--christmas-gold), var(--christmas-red)); 
                                   display: flex; align-items: center; justify-content: center; font-weight: bold;">
                            ${username.charAt(0)}
                        </div>
                        <div>
                            <div style="font-weight: bold; color: white;">${username}</div>
                            <div style="color: var(--christmas-gold); font-size: 0.8rem;">Player</div>
                        </div>
                    </div>
                `;
            }
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(34, 197, 94, 0.9)' : 
                          type === 'error' ? 'rgba(239, 68, 68, 0.9)' : 
                          'rgba(59, 130, 246, 0.9)'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 9999;
                animation: slideIn 0.3s ease-out;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                border-left: 4px solid ${type === 'success' ? '#16a34a' : 
                              type === 'error' ? '#dc2626' : '#2563eb'};
                max-width: 300px;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                     type === 'error' ? 'exclamation-circle' : 
                                     'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        function showDevJournal() {
            playSound('click');
            alert('üìò Development Journal - Graduate Requirement\n\nComplete document detailing:\n\n‚úì Database design decisions\n‚úì Algorithm implementations\n‚úì Predictive analytics system\n‚úì Magic power-up mechanics\n‚úì Interactive story engine\n‚úì Sound system integration\n‚úì Technical challenges overcome\n\nLocated in: docs/development-journal.md');
        }
        
        function showFeatures() {
            playSound('click');
            alert('‚úÖ All 6 Graduate Features Implemented:\n\n1. üß† Predictive Analytics & Behavior Analysis\n2. ‚ö° Magic Power-up System\n3. üìñ Interactive Christmas Story\n4. üñºÔ∏è Complete Photo Tiles\n5. üéµ Sound & Music System\n6. üìä Real-time Leaderboards\n\nPlus: Three unique puzzle versions, MySQL integration, responsive design, and animations.');
        }
        
        // Close modals with ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeLeaderboard();
                closeAnalytics();
                closeMagicModal();
                
                // Close any other custom modals
                const openModal = document.querySelector('div[style*="position: fixed; top: 0; left: 0; width: 100%"]');
                if (openModal && !openModal.id && !openModal.classList.contains('magic-system-modal')) {
                    openModal.remove();
                }
            }
        });
    </script>

<!-- ===== GUARANTEED MAGIC MODAL CLOSE FIX ===== -->
<script>
(function(){
    function killMagicOverlay() {
        const els = Array.from(document.body.children);
        els.forEach(el => {
            const cs = window.getComputedStyle(el);
            if (
                cs.position === 'fixed' &&
                (cs.top === '0px' || cs.top === '0') &&
                (cs.left === '0px' || cs.left === '0') &&
                (cs.width === '100vw' || cs.width === '100%') &&
                (cs.height === '100vh' || cs.height === '100%')
            ) {
                el.remove();
            }
        });
    }

    // ESC key ‚Äî capture phase, cannot be blocked
    document.addEventListener('keydown', function(e){
        if (e.key === 'Escape') {
            killMagicOverlay();
        }
    }, true);

    // Expose globally for close buttons
    window.killMagicOverlay = killMagicOverlay;
})();
</script>

</body>
</html>